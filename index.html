<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Craft.io â€” Survive & Conquer</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cinzel+Decorative:wght@700;900&display=swap');
:root{
  --gold:#f0c040;--gold2:#a07010;--dark:#0a0608;--panel:rgba(12,8,4,.93);
  --border:#5a3a10;--red:#cc2222;--green:#2d8c2d;--blue:#2255cc;
  --wood:#8B6914;--stone:#777;--coal:#222;--diamond:#00e5ff;
  --grass:#3a8c3a;--sand:#d4b060;
  --TILE:48px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;overflow:hidden;font-family:'Cinzel',serif;color:#e8d8a0;user-select:none;cursor:crosshair}

/* â•â•â•â•â•â•â• TELA LOGIN â•â•â•â•â•â•â• */
#login-screen{
  position:fixed;inset:0;z-index:9999;
  background:radial-gradient(ellipse at 50% 40%,#1a0d00 0%,#050208 60%,#000 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px
}
.login-particles{position:absolute;inset:0;overflow:hidden;pointer-events:none}
.login-particles span{position:absolute;width:2px;height:2px;background:var(--gold);border-radius:50%;animation:floatUp 6s linear infinite;opacity:0}
@keyframes floatUp{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.8}90%{opacity:.4}100%{transform:translateY(-20px) scale(1.5);opacity:0}}
.logo-title{font-family:'Cinzel Decorative',serif;font-size:clamp(2.5rem,8vw,6rem);color:var(--gold);letter-spacing:8px;text-shadow:0 0 30px #f0a000,0 0 60px #a06000;animation:logoPulse 3s ease-in-out infinite}
@keyframes logoPulse{0%,100%{text-shadow:0 0 30px #f0a000,0 0 60px #a06000}50%{text-shadow:0 0 50px #ffcc00,0 0 100px #f08000}}
.logo-sub{color:#a08040;font-size:clamp(.7rem,2vw,.95rem);letter-spacing:6px;margin-bottom:30px;font-style:italic}
.login-box{background:rgba(15,10,5,.92);border:2px solid var(--border);border-radius:8px;padding:32px 44px;display:flex;flex-direction:column;gap:14px;min-width:360px;box-shadow:0 0 60px rgba(240,160,0,.12)}
.login-box label{font-size:.7rem;letter-spacing:3px;color:#a08040}
.login-box input{background:rgba(20,14,5,.9);border:2px solid var(--border);color:#f0d060;font-family:'Cinzel',serif;font-size:1rem;padding:12px 16px;border-radius:4px;outline:none;transition:.3s;letter-spacing:2px}
.login-box input:focus{border-color:var(--gold);box-shadow:0 0 20px rgba(240,192,0,.2)}
.btn-enter{background:linear-gradient(180deg,#c09020,#6a4000);border:2px solid var(--gold);color:#fff8e0;font-family:'Cinzel',serif;font-size:1rem;padding:14px;border-radius:4px;cursor:pointer;letter-spacing:3px;transition:.3s}
.btn-enter:hover{background:linear-gradient(180deg,#f0b030,#a07010);box-shadow:0 0 30px rgba(240,192,0,.4);transform:translateY(-2px)}
.login-info{font-size:.6rem;color:#604020;letter-spacing:1.5px;text-align:center;font-style:italic}
.online-badge{background:rgba(0,200,0,.1);border:1px solid #2a6a2a;border-radius:20px;padding:6px 16px;color:#4aaa4a;font-size:.65rem;letter-spacing:2px;text-align:center}

/* â•â•â•â•â•â•â• CANVAS â•â•â•â•â•â•â• */
#gameCanvas{display:block;position:fixed;inset:0}

/* â•â•â•â•â•â•â• HUD â•â•â•â•â•â•â• */
#hud{position:fixed;inset:0;pointer-events:none;z-index:100}

/* â”€â”€ Coords top-left â”€â”€ */
#coords{position:absolute;top:14px;left:14px;background:var(--panel);border:1px solid var(--border);padding:10px 14px;border-radius:4px;font-size:.65rem;letter-spacing:1.5px;color:#c0a060;line-height:1.9;box-shadow:0 2px 10px #0008}
#coords span{color:var(--gold)}

/* â”€â”€ Painel do jogador (classe/stats) â”€â”€ */
#player-panel{position:absolute;top:14px;left:200px;background:var(--panel);border:1px solid var(--border);border-radius:4px;padding:10px 14px;font-size:.65rem;letter-spacing:1px;color:#a09060;min-width:180px}
.pp-class{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.pp-class-icon{font-size:1.6rem;line-height:1}
.pp-class-name{color:var(--gold);font-size:.85rem;letter-spacing:2px;font-weight:700}
.pp-class-desc{font-size:.55rem;color:#806040;font-style:italic}
.pp-row{display:flex;justify-content:space-between;gap:14px;line-height:1.9}
.pp-val{color:#e0d080}
.pp-kills-bar{width:100%;height:6px;background:#1a100a;border:1px solid #2a1808;border-radius:2px;overflow:hidden;margin-top:4px}
.pp-kills-fill{height:100%;background:linear-gradient(90deg,#aa1111,#ff6600,#ffdd00);transition:width .5s}

/* â”€â”€ Barras (bottom center, acima hotbar) â”€â”€ */
#bars{position:absolute;bottom:136px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:5px;pointer-events:none}
.bar-row{display:flex;align-items:center;gap:6px}
.bar-label{font-size:.52rem;letter-spacing:1.5px;color:#a09060;width:52px;text-align:right}
.bar-bg{width:190px;height:9px;background:#1a100a;border:1px solid #3a2010;border-radius:2px;overflow:hidden}
.bar-fill{height:100%;border-radius:2px;transition:.4s}
#hp-fill{background:linear-gradient(90deg,#aa1111,#ee3333)}
#hunger-fill{background:linear-gradient(90deg,#884400,#ffaa00)}
#xp-fill{background:linear-gradient(90deg,#0044aa,#00ccff)}
.bar-val{font-size:.52rem;color:#908060;width:32px}

/* â”€â”€ HOTBAR â”€â”€ */
#hotbar{position:absolute;bottom:58px;left:50%;transform:translateX(-50%);display:flex;gap:4px;pointer-events:all}
.slot{width:56px;height:56px;background:rgba(15,10,5,.88);border:2px solid #3a2010;border-radius:4px;display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:.45rem;color:#806040;cursor:pointer;transition:.2s;position:relative;overflow:hidden}
.slot:hover{border-color:#a06020;background:rgba(30,20,5,.92)}
.slot.active{border-color:var(--gold);box-shadow:0 0 14px rgba(240,192,0,.5)}
.slot .item-icon{font-size:1.5rem;line-height:1}
.slot .item-count{position:absolute;bottom:3px;right:4px;font-size:.55rem;color:#e0c060;font-weight:700;text-shadow:0 1px 2px #000}
.slot-num{position:absolute;top:2px;left:4px;font-size:.42rem;color:#503010}

/* â”€â”€ LEADERBOARD top-right â”€â”€ */
#leaderboard{position:absolute;top:14px;right:165px;background:var(--panel);border:1px solid var(--border);padding:10px 14px;border-radius:4px;min-width:170px;font-size:.62rem;letter-spacing:.5px}
#leaderboard h4{color:var(--gold);letter-spacing:3px;font-size:.58rem;margin-bottom:8px;text-align:center;border-bottom:1px solid var(--border);padding-bottom:5px}
.lb-row{display:flex;justify-content:space-between;gap:12px;color:#a09060;line-height:2}
.lb-row.lb-me{color:#f0d060}
.lb-rank{color:#604020;width:14px}
.lb-class{width:16px;text-align:center}

/* â”€â”€ MINIMAP top-right â”€â”€ */
#minimap-wrap{position:absolute;top:14px;right:14px;background:var(--panel);border:2px solid var(--border);padding:7px;border-radius:4px}
#minimap-wrap h4{font-size:.52rem;letter-spacing:2px;color:#806030;text-align:center;margin-bottom:5px}
#minimap{width:140px;height:140px;border:1px solid #3a2010;image-rendering:pixelated}

/* â”€â”€ NOTIFICAÃ‡Ã•ES â€” lado direito abaixo do minimap â”€â”€ */
#notifs{
  position:absolute;right:14px;top:220px;
  display:flex;flex-direction:column;gap:5px;
  pointer-events:none;width:220px;
}
.notif{
  background:rgba(12,8,4,.93);border:1px solid var(--border);border-radius:3px;
  padding:7px 12px;font-size:.65rem;letter-spacing:1px;color:#e0c060;
  text-align:right;border-right:3px solid var(--gold);
  animation:notifSlide .3s ease,notifFade .5s 2.5s ease forwards;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.notif.notif-kill{border-right-color:#ff4444;color:#ff9988}
.notif.notif-levelup{border-right-color:#ffdd00;color:#ffee88}
.notif.notif-craft{border-right-color:#44ff88;color:#88ffbb}
.notif.notif-dmg{border-right-color:#ff6600;color:#ffaa88}
@keyframes notifSlide{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
@keyframes notifFade{to{opacity:0;transform:translateX(20px)}}

/* â”€â”€ CHAT bottom-left â”€â”€ */
#chat-box{position:absolute;bottom:130px;left:14px;width:285px;pointer-events:all}
#chat-msgs{max-height:110px;overflow-y:auto;display:flex;flex-direction:column;gap:2px;margin-bottom:5px}
.chat-msg{font-size:.6rem;color:#c0a060;letter-spacing:.3px;line-height:1.4;padding:1px 0}
.chat-msg .cn{color:var(--gold);font-weight:700}
.chat-msg.sys{color:#6a8a6a;font-style:italic}
.chat-msg.pvp{color:#cc4444}
#chat-input-row{display:flex;gap:5px}
#chat-input{flex:1;background:rgba(10,6,3,.88);border:1px solid var(--border);color:#e0c060;font-family:'Cinzel',serif;font-size:.62rem;padding:7px 10px;border-radius:3px;outline:none;letter-spacing:.5px}
#chat-input:focus{border-color:var(--gold)}
#chat-send{background:rgba(60,35,5,.85);border:1px solid var(--border);color:#c0a040;font-family:'Cinzel',serif;font-size:.6rem;padding:7px 10px;border-radius:3px;cursor:pointer;transition:.2s}
#chat-send:hover{border-color:var(--gold)}

/* â”€â”€ BOTÃ•ES HUD bottom â”€â”€ */
#hud-btns{position:absolute;bottom:14px;left:50%;transform:translateX(-50%);display:flex;gap:7px;pointer-events:all}
.hud-btn{background:rgba(20,12,5,.88);border:1px solid var(--border);color:#c0a040;font-family:'Cinzel',serif;font-size:.58rem;padding:7px 12px;border-radius:3px;cursor:pointer;letter-spacing:1.5px;transition:.2s}
.hud-btn:hover{border-color:var(--gold);color:var(--gold);background:rgba(40,24,5,.92)}

/* â”€â”€ TOOLTIP â”€â”€ */
#tooltip{display:none;position:fixed;background:rgba(15,10,5,.97);border:1px solid var(--border);border-radius:4px;padding:10px 14px;font-size:.62rem;letter-spacing:.8px;color:#e0c060;pointer-events:none;z-index:9999;max-width:210px;line-height:1.8;box-shadow:0 4px 20px #000a}
#tooltip h5{color:var(--gold);letter-spacing:2px;margin-bottom:3px;font-size:.68rem}
#tooltip .tdesc{color:#806040;font-size:.57rem;font-style:italic}
#tooltip .tstat{color:#aabb88}
#tooltip .tcraft{color:#88ccff;font-size:.57rem}

/* â•â•â•â•â•â•â• INVENTÃRIO (overlay) â•â•â•â•â•â•â• */
#inventory-screen{display:none;position:fixed;inset:0;z-index:500;background:rgba(4,2,1,.88);backdrop-filter:blur(4px);align-items:center;justify-content:center;pointer-events:all}
#inventory-screen.open{display:flex}
.inv-panel{background:linear-gradient(160deg,#1a100a,#0d0808);border:2px solid var(--border);border-radius:8px;padding:22px;width:min(700px,96vw);max-height:90vh;overflow-y:auto;box-shadow:0 0 80px rgba(0,0,0,.85)}
.inv-panel h2{font-family:'Cinzel Decorative',serif;color:var(--gold);font-size:1.1rem;letter-spacing:4px;margin-bottom:16px;text-align:center}
.inv-tabs{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
.inv-tab{background:rgba(20,12,5,.85);border:1px solid var(--border);color:#a08040;font-family:'Cinzel',serif;font-size:.6rem;padding:7px 14px;border-radius:3px;cursor:pointer;letter-spacing:1.5px;transition:.2s}
.inv-tab.active{background:rgba(60,35,5,.92);border-color:var(--gold);color:var(--gold)}
.inv-grid{display:grid;grid-template-columns:repeat(auto-fill,58px);gap:5px}
.inv-slot{width:58px;height:58px;background:rgba(10,6,3,.85);border:2px solid #2a1808;border-radius:4px;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer;transition:.2s;position:relative}
.inv-slot:hover{border-color:#a06020;background:rgba(30,18,5,.92)}
.inv-slot .item-icon{font-size:1.6rem;line-height:1}
.inv-slot .item-count{position:absolute;bottom:2px;right:4px;font-size:.55rem;color:#e0c060;font-weight:700;text-shadow:0 1px 2px #000}
.inv-slot .item-name{font-size:.36rem;color:#604020;text-align:center;margin-top:1px;line-height:1.2}
.inv-slot.empty{border-color:#1a1008;cursor:default}
.close-btn{background:linear-gradient(180deg,#5a2010,#3a1005);border:1px solid #a04020;color:#f0a060;font-family:'Cinzel',serif;font-size:.65rem;padding:8px 20px;border-radius:3px;cursor:pointer;letter-spacing:2px;transition:.2s;margin-top:14px}
.close-btn:hover{background:linear-gradient(180deg,#8a3010,#5a1808)}

/* â•â•â•â•â•â•â• CRAFT â•â•â•â•â•â•â• */
#craft-screen{display:none;position:fixed;inset:0;z-index:500;background:rgba(4,2,1,.88);backdrop-filter:blur(4px);align-items:center;justify-content:center;pointer-events:all}
#craft-screen.open{display:flex}
.craft-panel{background:linear-gradient(160deg,#1a100a,#0d0808);border:2px solid var(--border);border-radius:8px;padding:22px;width:min(780px,96vw);max-height:92vh;overflow-y:auto}
.craft-panel h2{font-family:'Cinzel Decorative',serif;color:var(--gold);letter-spacing:4px;margin-bottom:14px;text-align:center;font-size:1.1rem}
.craft-search{width:100%;background:rgba(10,6,3,.85);border:1px solid var(--border);color:#e0c060;font-family:'Cinzel',serif;font-size:.72rem;padding:9px 13px;border-radius:4px;outline:none;margin-bottom:10px;letter-spacing:.8px}
.craft-search:focus{border-color:var(--gold)}
.craft-cats{display:flex;gap:5px;margin-bottom:12px;flex-wrap:wrap}
.craft-cat{background:rgba(20,12,5,.85);border:1px solid var(--border);color:#806040;font-family:'Cinzel',serif;font-size:.58rem;padding:6px 11px;border-radius:3px;cursor:pointer;letter-spacing:1px;transition:.2s}
.craft-cat.active{background:rgba(60,35,5,.92);border-color:var(--gold);color:var(--gold)}
.craft-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:8px}
.craft-item{background:rgba(15,9,4,.88);border:1px solid #2a1808;border-radius:5px;padding:11px;cursor:pointer;transition:.25s;display:flex;gap:9px;align-items:flex-start}
.craft-item:hover{border-color:#a06020;background:rgba(30,18,5,.92);transform:translateY(-1px)}
.craft-item.can{border-color:#2a6a1a}
.craft-item.can:hover{border-color:#4aaa2a;box-shadow:0 0 10px rgba(80,200,40,.12)}
.craft-icon{font-size:1.9rem;width:38px;text-align:center;flex-shrink:0}
.craft-info h4{font-size:.68rem;color:#e0c060;letter-spacing:.8px;margin-bottom:3px}
.craft-reqs{font-size:.52rem;color:#806040;line-height:1.7}
.craft-reqs .has{color:#6aaa4a}.craft-reqs .lacks{color:#aa4444}
.craft-do{background:linear-gradient(180deg,#604010,#3a2005);border:1px solid #a06020;color:#f0d060;font-family:'Cinzel',serif;font-size:.58rem;padding:5px 9px;border-radius:3px;cursor:pointer;letter-spacing:.8px;margin-top:5px;transition:.2s}
.craft-do:hover:not(:disabled){background:linear-gradient(180deg,#a07020,#6a4010)}
.craft-do:disabled{opacity:.35;cursor:not-allowed}

/* â•â•â•â•â•â•â• DEATH â•â•â•â•â•â•â• */
#death-screen{display:none;position:fixed;inset:0;z-index:800;background:rgba(80,0,0,.65);backdrop-filter:blur(7px);align-items:center;justify-content:center;flex-direction:column;gap:18px;pointer-events:all}
#death-screen.show{display:flex}
#death-screen h2{font-family:'Cinzel Decorative',serif;font-size:3rem;color:#ff2222;text-shadow:0 0 30px #ff0000;animation:deathPulse 1s ease-in-out infinite}
@keyframes deathPulse{0%,100%{opacity:1}50%{opacity:.4}}
#death-screen p{color:#cc6666;letter-spacing:3px;font-size:.85rem}
#respawn-btn{background:linear-gradient(180deg,#aa1010,#550000);border:2px solid #ff3333;color:#ffcccc;font-family:'Cinzel',serif;font-size:1rem;padding:13px 36px;border-radius:4px;cursor:pointer;letter-spacing:3px;transition:.3s}
#respawn-btn:hover{box-shadow:0 0 30px rgba(255,0,0,.4)}

/* â•â•â•â•â•â•â• BUILD PANEL â•â•â•â•â•â•â• */
#build-panel{display:none;position:absolute;right:165px;top:50%;transform:translateY(-50%);background:var(--panel);border:2px solid var(--border);border-radius:6px;padding:14px;pointer-events:all;z-index:200}
#build-panel.open{display:block}
#build-panel h4{color:var(--gold);letter-spacing:2px;font-size:.62rem;margin-bottom:10px;text-align:center}
.build-grid{display:grid;grid-template-columns:repeat(3,56px);gap:5px}
.build-slot{width:56px;height:56px;background:rgba(10,6,3,.85);border:2px solid #2a1808;border-radius:4px;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer;transition:.2s;position:relative}
.build-slot:hover{border-color:#a06020}
.build-slot.sel{border-color:var(--gold);box-shadow:0 0 8px rgba(240,192,0,.4)}
.build-slot .item-icon{font-size:1.4rem}
.build-slot .bcount{position:absolute;bottom:2px;right:4px;font-size:.5rem;color:#e0c060;font-weight:700}

/* â•â•â•â•â•â•â• CLASS UPGRADE POPUP â•â•â•â•â•â•â• */
#class-popup{
  display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  z-index:900;background:linear-gradient(160deg,#1a0a00,#080508);
  border:3px solid var(--gold);border-radius:12px;padding:36px 48px;
  text-align:center;pointer-events:none;
  box-shadow:0 0 80px rgba(240,160,0,.4);
  animation:classPopIn .5s ease;
}
@keyframes classPopIn{from{opacity:0;transform:translate(-50%,-50%) scale(.5)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
#class-popup .cp-icon{font-size:4rem;line-height:1;margin-bottom:8px}
#class-popup .cp-title{font-family:'Cinzel Decorative',serif;font-size:1.5rem;color:var(--gold);letter-spacing:4px;margin-bottom:4px}
#class-popup .cp-name{font-size:1.1rem;color:#fff;letter-spacing:3px}
#class-popup .cp-desc{font-size:.7rem;color:#a08040;font-style:italic;margin-top:8px;letter-spacing:1px}

/* scrollbar */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:#0a0608}
::-webkit-scrollbar-thumb{background:#3a2010;border-radius:2px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-particles" id="particles"></div>
  <div class="logo-title">âš” CRAFT.IO</div>
  <div class="logo-sub">SURVIVE Â· CRAFT Â· CONQUER</div>
  <div class="login-box">
    <div class="online-badge" id="online-badge">ğŸŸ¢ CONECTANDO...</div>
    <label>SEU NOME DE GUERREIRO</label>
    <input type="text" id="player-name-input" placeholder="Digite seu nome..." maxlength="18" autofocus />
    <button class="btn-enter" onclick="enterGame()">âš” ENTRAR NO MUNDO</button>
    <div class="login-info">WASD Â· Mover &nbsp;|&nbsp; CLIQUE Â· Coletar/Atacar &nbsp;|&nbsp; E Â· Inv &nbsp;|&nbsp; C Â· Craft &nbsp;|&nbsp; B Â· Construir &nbsp;|&nbsp; T Â· Chat</div>
  </div>
</div>

<!-- CANVAS -->
<canvas id="gameCanvas"></canvas>

<!-- HUD -->
<div id="hud" style="display:none">
  <div id="coords">X: <span id="cx">0</span> &nbsp;Y: <span id="cy">0</span><br>Bioma: <span id="biome-name">â€”</span><br>Dia: <span id="day-num">1</span> &nbsp;<span id="time-str">â˜€ Dia</span></div>

  <div id="player-panel">
    <div class="pp-class">
      <span class="pp-class-icon" id="pp-icon">ğŸ§‘</span>
      <div>
        <div class="pp-class-name" id="pp-name">AldeÃ£o</div>
        <div class="pp-class-desc" id="pp-desc">O inÃ­cio da jornada</div>
      </div>
    </div>
    <div class="pp-row"><span>Kills</span><span class="pp-val" id="pp-kills">0</span></div>
    <div class="pp-row"><span>Mortes</span><span class="pp-val" id="pp-deaths">0</span></div>
    <div class="pp-row"><span>PrÃ³x. nÃ­vel</span><span class="pp-val" id="pp-next">5 kills</span></div>
    <div class="pp-kills-bar"><div class="pp-kills-fill" id="pp-kills-fill" style="width:0%"></div></div>
  </div>

  <div id="bars">
    <div class="bar-row"><span class="bar-label">â¤ HP</span><div class="bar-bg"><div class="bar-fill" id="hp-fill" style="width:100%"></div></div><span class="bar-val" id="hp-val">80</span></div>
    <div class="bar-row"><span class="bar-label">ğŸ– FOME</span><div class="bar-bg"><div class="bar-fill" id="hunger-fill" style="width:100%"></div></div><span class="bar-val" id="hunger-val">100</span></div>
    <div class="bar-row"><span class="bar-label">âœ¨ XP</span><div class="bar-bg"><div class="bar-fill" id="xp-fill" style="width:0%"></div></div><span class="bar-val" id="xp-val">0</span></div>
  </div>

  <div id="hotbar"></div>
  <div id="hud-btns">
    <button class="hud-btn" onclick="toggleInventory()">ğŸ“¦ INV [E]</button>
    <button class="hud-btn" onclick="toggleCraft()">âš’ CRAFT [C]</button>
    <button class="hud-btn" onclick="toggleBuild()">ğŸ— BUILD [B]</button>
    <button class="hud-btn" onclick="dropSelected()">ğŸ—‘ DROPAR</button>
  </div>

  <div id="chat-box">
    <div id="chat-msgs"></div>
    <div id="chat-input-row">
      <input type="text" id="chat-input" placeholder="Pressione T para chat..." maxlength="100"/>
      <button id="chat-send" onclick="sendChat()">â†µ</button>
    </div>
  </div>

  <div id="leaderboard">
    <h4>ğŸ† RANKING</h4>
    <div id="lb-list"></div>
  </div>
  <div id="minimap-wrap">
    <h4>ğŸ—º MAPA</h4>
    <canvas id="minimap" width="140" height="140"></canvas>
  </div>
  <div id="notifs"></div>
  <div id="build-panel">
    <h4>ğŸ— CONSTRUÃ‡ÃƒO</h4>
    <div class="build-grid" id="build-grid"></div>
    <div style="margin-top:8px;text-align:center"><button class="close-btn" style="font-size:.55rem;padding:5px 10px" onclick="toggleBuild()">âœ– FECHAR</button></div>
  </div>
</div>

<!-- INVENTÃRIO -->
<div id="inventory-screen">
  <div class="inv-panel">
    <h2>ğŸ“¦ INVENTÃRIO</h2>
    <div class="inv-tabs">
      <button class="inv-tab active" onclick="invTab('all',this)">TUDO</button>
      <button class="inv-tab" onclick="invTab('resources',this)">RECURSOS</button>
      <button class="inv-tab" onclick="invTab('tools',this)">FERRAMENTAS</button>
      <button class="inv-tab" onclick="invTab('weapons',this)">ARMAS</button>
      <button class="inv-tab" onclick="invTab('food',this)">COMIDA</button>
      <button class="inv-tab" onclick="invTab('blocks',this)">BLOCOS</button>
    </div>
    <div class="inv-grid" id="inv-grid"></div>
    <div style="text-align:center"><button class="close-btn" onclick="toggleInventory()">âœ– FECHAR [E]</button></div>
  </div>
</div>

<!-- CRAFT -->
<div id="craft-screen">
  <div class="craft-panel">
    <h2>âš’ MESA DE CRAFT</h2>
    <input class="craft-search" type="text" id="craft-search" placeholder="Buscar receita..." oninput="filterCraft()"/>
    <div class="craft-cats" id="craft-cats"></div>
    <div class="craft-list" id="craft-list"></div>
    <div style="text-align:center"><button class="close-btn" onclick="toggleCraft()">âœ– FECHAR [C]</button></div>
  </div>
</div>

<!-- DEATH -->
<div id="death-screen">
  <h2>ğŸ’€ VOCÃŠ MORREU</h2>
  <p id="death-msg">Morto por: Fome</p>
  <button id="respawn-btn" onclick="requestRespawn()">â†º RENASCER</button>
</div>

<!-- CLASS POPUP -->
<div id="class-popup">
  <div class="cp-icon" id="cp-icon">âš”</div>
  <div class="cp-title">EVOLUÃ‡ÃƒO!</div>
  <div class="cp-name" id="cp-name">Guerreiro</div>
  <div class="cp-desc" id="cp-desc">VocÃª se tornou mais poderoso!</div>
</div>

<div id="tooltip"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ENGINE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
"use strict";
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DADOS DE ITEMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ITEMS_DB = {
  oak_log:{name:"Carvalho",icon:"ğŸªµ",cat:"resources"},
  birch_log:{name:"BÃ©tula",icon:"ğŸªµ",cat:"resources"},
  spruce_log:{name:"Abeto",icon:"ğŸªµ",cat:"resources"},
  jungle_log:{name:"Madeira Selva",icon:"ğŸªµ",cat:"resources"},
  acacia_log:{name:"AcÃ¡cia",icon:"ğŸªµ",cat:"resources"},
  dark_oak_log:{name:"Carvalho Escuro",icon:"ğŸªµ",cat:"resources"},
  stone:{name:"Pedra",icon:"ğŸª¨",cat:"resources"},
  cobblestone:{name:"Pedra Tosca",icon:"ğŸª¨",cat:"resources"},
  granite:{name:"Granito",icon:"ğŸª¨",cat:"resources"},
  diorite:{name:"Diorito",icon:"ğŸª¨",cat:"resources"},
  andesite:{name:"Andesito",icon:"ğŸª¨",cat:"resources"},
  coal_ore:{name:"CarvÃ£o",icon:"â¬›",cat:"resources"},
  iron_ore:{name:"MinÃ©rio de Ferro",icon:"ğŸŸ«",cat:"resources"},
  gold_ore:{name:"MinÃ©rio de Ouro",icon:"ğŸŸ¡",cat:"resources"},
  diamond_ore:{name:"Diamante",icon:"ğŸ’",cat:"resources"},
  emerald_ore:{name:"Esmeralda",icon:"ğŸ’š",cat:"resources"},
  lapis_ore:{name:"LÃ¡pis-LazÃºli",icon:"ğŸ”µ",cat:"resources"},
  redstone_ore:{name:"Redstone",icon:"ğŸ”´",cat:"resources"},
  netherite_scrap:{name:"Sucata Netherita",icon:"ğŸŸ£",cat:"resources"},
  iron_ingot:{name:"Lingote de Ferro",icon:"â¬œ",cat:"resources"},
  gold_ingot:{name:"Lingote de Ouro",icon:"ğŸŸ¨",cat:"resources"},
  netherite_ingot:{name:"Netherita",icon:"ğŸŸ¤",cat:"resources"},
  sand:{name:"Areia",icon:"ğŸ–",cat:"resources"},
  gravel:{name:"Cascalho",icon:"â¬›",cat:"resources"},
  clay:{name:"Argila",icon:"ğŸ§±",cat:"resources"},
  dirt:{name:"Terra",icon:"ğŸŸ«",cat:"resources"},
  flint:{name:"SÃ­lex",icon:"â—‡",cat:"resources"},
  bone:{name:"Osso",icon:"ğŸ¦´",cat:"resources"},
  feather:{name:"Pena",icon:"ğŸª¶",cat:"resources"},
  leather:{name:"Couro",icon:"ğŸŸ«",cat:"resources"},
  string:{name:"Fio",icon:"ã€°",cat:"resources"},
  slimeball:{name:"Gosma",icon:"ğŸŸ¢",cat:"resources"},
  gunpowder:{name:"PÃ³lvora",icon:"ğŸ’¥",cat:"resources"},
  blaze_rod:{name:"BastÃ£o Blaze",icon:"ğŸ”¥",cat:"resources"},
  glowstone_dust:{name:"PÃ³ Brilhante",icon:"âœ¨",cat:"resources"},
  wheat:{name:"Trigo",icon:"ğŸŒ¾",cat:"resources"},
  sugar:{name:"AÃ§Ãºcar",icon:"ğŸ¤",cat:"resources"},
  wool:{name:"LÃ£",icon:"ğŸ‘",cat:"resources"},
  red_mushroom:{name:"Cogumelo Vermelho",icon:"ğŸ„",cat:"resources"},
  brown_mushroom:{name:"Cogumelo Marrom",icon:"ğŸ„",cat:"resources"},
  sugar_cane:{name:"Cana-de-aÃ§Ãºcar",icon:"ğŸŒ¿",cat:"resources"},
  egg:{name:"Ovo",icon:"ğŸ¥š",cat:"resources"},
  milk:{name:"Leite",icon:"ğŸ¥›",cat:"resources"},
  apple:{name:"MaÃ§Ã£",icon:"ğŸ",cat:"food",hunger:4},
  bread:{name:"PÃ£o",icon:"ğŸ",cat:"food",hunger:6},
  cooked_beef:{name:"Bife Assado",icon:"ğŸ¥©",cat:"food",hunger:9},
  cooked_chicken:{name:"Frango Assado",icon:"ğŸ—",cat:"food",hunger:7},
  cooked_pork:{name:"Porco Assado",icon:"ğŸ¥“",cat:"food",hunger:8},
  cooked_fish:{name:"Peixe Assado",icon:"ğŸŸ",cat:"food",hunger:6},
  golden_apple:{name:"MaÃ§Ã£ Dourada",icon:"ğŸ",cat:"food",hunger:10,hp:20},
  mushroom_stew:{name:"Ensopado Cogumelo",icon:"ğŸ²",cat:"food",hunger:8},
  carrot:{name:"Cenoura",icon:"ğŸ¥•",cat:"food",hunger:4},
  potato:{name:"Batata Assada",icon:"ğŸ¥”",cat:"food",hunger:6},
  melon_slice:{name:"MelÃ£o",icon:"ğŸ‰",cat:"food",hunger:3},
  cake:{name:"Bolo",icon:"ğŸ‚",cat:"food",hunger:12},
  cookie:{name:"Cookie",icon:"ğŸª",cat:"food",hunger:3},
  wooden_pickaxe:{name:"Picareta Madeira",icon:"â›",cat:"tools",damage:2,efficiency:1.2},
  wooden_axe:{name:"Machado Madeira",icon:"ğŸª“",cat:"tools",damage:3},
  wooden_sword:{name:"Espada Madeira",icon:"ğŸ—¡",cat:"weapons",damage:5},
  wooden_shovel:{name:"PÃ¡ Madeira",icon:"ğŸª£",cat:"tools"},
  wooden_hoe:{name:"Enxada Madeira",icon:"ğŸŒ±",cat:"tools"},
  stone_pickaxe:{name:"Picareta Pedra",icon:"â›",cat:"tools",damage:3,efficiency:2},
  stone_axe:{name:"Machado Pedra",icon:"ğŸª“",cat:"tools",damage:5},
  stone_sword:{name:"Espada Pedra",icon:"ğŸ—¡",cat:"weapons",damage:8},
  stone_shovel:{name:"PÃ¡ Pedra",icon:"ğŸª£",cat:"tools"},
  iron_pickaxe:{name:"Picareta Ferro",icon:"â›",cat:"tools",damage:4,efficiency:3},
  iron_axe:{name:"Machado Ferro",icon:"ğŸª“",cat:"tools",damage:7},
  iron_sword:{name:"Espada Ferro",icon:"âš”",cat:"weapons",damage:13},
  iron_shovel:{name:"PÃ¡ Ferro",icon:"ğŸª£",cat:"tools"},
  iron_helmet:{name:"Elmo de Ferro",icon:"â›‘",cat:"tools",defense:5},
  iron_chestplate:{name:"Peitoral Ferro",icon:"ğŸ›¡",cat:"tools",defense:10},
  iron_leggings:{name:"CalÃ§as Ferro",icon:"ğŸ¦º",cat:"tools",defense:8},
  iron_boots:{name:"Botas Ferro",icon:"ğŸ‘¢",cat:"tools",defense:3},
  gold_sword:{name:"Espada Ouro",icon:"ğŸ—¡",cat:"weapons",damage:10},
  gold_pickaxe:{name:"Picareta Ouro",icon:"â›",cat:"tools",damage:3,efficiency:4},
  diamond_pickaxe:{name:"Picareta Diamante",icon:"â›",cat:"tools",damage:5,efficiency:5},
  diamond_sword:{name:"Espada Diamante",icon:"ğŸ’ ",cat:"weapons",damage:20},
  diamond_helmet:{name:"Elmo Diamante",icon:"â›‘",cat:"tools",defense:12},
  diamond_chestplate:{name:"Peitoral Diamante",icon:"ğŸ›¡",cat:"tools",defense:20},
  netherite_sword:{name:"Espada Netherita",icon:"âš¡",cat:"weapons",damage:35},
  netherite_pickaxe:{name:"Picareta Netherita",icon:"â›",cat:"tools",damage:6,efficiency:6},
  bow:{name:"Arco",icon:"ğŸ¹",cat:"weapons",damage:9,ranged:true},
  arrow:{name:"Flechas",icon:"â†‘",cat:"weapons"},
  shield:{name:"Escudo",icon:"ğŸ›¡",cat:"weapons",defense:15},
  planks:{name:"TÃ¡buas",icon:"ğŸªµ",cat:"blocks"},
  crafting_table:{name:"Mesa de Craft",icon:"ğŸªš",cat:"blocks"},
  furnace:{name:"Fornalha",icon:"ğŸ”¥",cat:"blocks"},
  chest:{name:"BaÃº",icon:"ğŸ“¦",cat:"blocks"},
  torch:{name:"Tocha",icon:"ğŸ”¦",cat:"blocks"},
  stone_wall:{name:"Parede Pedra",icon:"ğŸ§±",cat:"blocks"},
  glass:{name:"Vidro",icon:"ğŸ”²",cat:"blocks"},
  bed:{name:"Cama",icon:"ğŸ›",cat:"blocks"},
  door:{name:"Porta",icon:"ğŸšª",cat:"blocks"},
  ladder:{name:"Escada",icon:"ğŸªœ",cat:"blocks"},
  stick:{name:"Graveto",icon:"ğŸ¥¢",cat:"resources"},
  bowl:{name:"Tigela",icon:"ğŸ¥£",cat:"resources"},
  bucket:{name:"Balde",icon:"ğŸª£",cat:"tools"},
  compass:{name:"BÃºssola",icon:"ğŸ§­",cat:"tools"},
  fishing_rod:{name:"Vara de Pescar",icon:"ğŸ£",cat:"tools"},
  book:{name:"Livro",icon:"ğŸ“–",cat:"tools"},
};

const RECIPES = {
  stick:{name:"Graveto x4",icon:"ğŸ¥¢",cat:"resources",req:{planks:2},gives:{stick:4}},
  planks:{name:"TÃ¡buas x4",icon:"ğŸªµ",cat:"blocks",req:{oak_log:1},gives:{planks:4}},
  crafting_table:{name:"Mesa de Craft",icon:"ğŸªš",cat:"blocks",req:{planks:4},gives:{crafting_table:1}},
  furnace:{name:"Fornalha",icon:"ğŸ”¥",cat:"blocks",req:{cobblestone:8},gives:{furnace:1}},
  chest:{name:"BaÃº",icon:"ğŸ“¦",cat:"blocks",req:{planks:8},gives:{chest:1}},
  torch:{name:"Tocha x4",icon:"ğŸ”¦",cat:"blocks",req:{coal_ore:1,oak_log:1},gives:{torch:4}},
  stone_wall:{name:"Parede Pedra x6",icon:"ğŸ§±",cat:"blocks",req:{cobblestone:6},gives:{stone_wall:6}},
  glass:{name:"Vidro x4",icon:"ğŸ”²",cat:"blocks",req:{sand:4},gives:{glass:4}},
  door:{name:"Porta x2",icon:"ğŸšª",cat:"blocks",req:{planks:6},gives:{door:2}},
  bed:{name:"Cama",icon:"ğŸ›",cat:"blocks",req:{planks:3,wool:3},gives:{bed:1}},
  ladder:{name:"Escada x4",icon:"ğŸªœ",cat:"blocks",req:{oak_log:7},gives:{ladder:4}},
  wooden_pickaxe:{name:"Picareta Madeira",icon:"â›",cat:"tools",req:{oak_log:3},gives:{wooden_pickaxe:1}},
  wooden_axe:{name:"Machado Madeira",icon:"ğŸª“",cat:"tools",req:{oak_log:3},gives:{wooden_axe:1}},
  wooden_sword:{name:"Espada Madeira",icon:"ğŸ—¡",cat:"weapons",req:{oak_log:2},gives:{wooden_sword:1}},
  wooden_shovel:{name:"PÃ¡ Madeira",icon:"ğŸª£",cat:"tools",req:{oak_log:2},gives:{wooden_shovel:1}},
  wooden_hoe:{name:"Enxada Madeira",icon:"ğŸŒ±",cat:"tools",req:{oak_log:2},gives:{wooden_hoe:1}},
  stone_pickaxe:{name:"Picareta Pedra",icon:"â›",cat:"tools",req:{cobblestone:3,oak_log:2},gives:{stone_pickaxe:1}},
  stone_axe:{name:"Machado Pedra",icon:"ğŸª“",cat:"tools",req:{cobblestone:3,oak_log:2},gives:{stone_axe:1}},
  stone_sword:{name:"Espada Pedra",icon:"ğŸ—¡",cat:"weapons",req:{cobblestone:2,oak_log:1},gives:{stone_sword:1}},
  stone_shovel:{name:"PÃ¡ Pedra",icon:"ğŸª£",cat:"tools",req:{cobblestone:2,oak_log:1},gives:{stone_shovel:1}},
  iron_pickaxe:{name:"Picareta Ferro",icon:"â›",cat:"tools",req:{iron_ingot:3,oak_log:2},gives:{iron_pickaxe:1}},
  iron_axe:{name:"Machado Ferro",icon:"ğŸª“",cat:"tools",req:{iron_ingot:3,oak_log:2},gives:{iron_axe:1}},
  iron_sword:{name:"Espada Ferro",icon:"âš”",cat:"weapons",req:{iron_ingot:2,oak_log:1},gives:{iron_sword:1}},
  iron_shovel:{name:"PÃ¡ Ferro",icon:"ğŸª£",cat:"tools",req:{iron_ingot:2,oak_log:1},gives:{iron_shovel:1}},
  iron_helmet:{name:"Elmo Ferro",icon:"â›‘",cat:"tools",req:{iron_ingot:5},gives:{iron_helmet:1}},
  iron_chestplate:{name:"Peitoral Ferro",icon:"ğŸ›¡",cat:"tools",req:{iron_ingot:8},gives:{iron_chestplate:1}},
  iron_leggings:{name:"CalÃ§as Ferro",icon:"ğŸ¦º",cat:"tools",req:{iron_ingot:7},gives:{iron_leggings:1}},
  iron_boots:{name:"Botas Ferro",icon:"ğŸ‘¢",cat:"tools",req:{iron_ingot:4},gives:{iron_boots:1}},
  gold_sword:{name:"Espada Ouro",icon:"ğŸ—¡",cat:"weapons",req:{gold_ingot:2,oak_log:1},gives:{gold_sword:1}},
  gold_pickaxe:{name:"Picareta Ouro",icon:"â›",cat:"tools",req:{gold_ingot:3,oak_log:2},gives:{gold_pickaxe:1}},
  diamond_pickaxe:{name:"Picareta Diamante",icon:"â›",cat:"tools",req:{diamond_ore:3,oak_log:2},gives:{diamond_pickaxe:1}},
  diamond_sword:{name:"Espada Diamante",icon:"ğŸ’ ",cat:"weapons",req:{diamond_ore:2,oak_log:1},gives:{diamond_sword:1}},
  diamond_helmet:{name:"Elmo Diamante",icon:"â›‘",cat:"tools",req:{diamond_ore:5},gives:{diamond_helmet:1}},
  diamond_chestplate:{name:"Peitoral Diamante",icon:"ğŸ›¡",cat:"tools",req:{diamond_ore:8},gives:{diamond_chestplate:1}},
  netherite_sword:{name:"Espada Netherita",icon:"âš¡",cat:"weapons",req:{diamond_sword:1,netherite_ingot:1},gives:{netherite_sword:1}},
  netherite_pickaxe:{name:"Picareta Netherita",icon:"â›",cat:"tools",req:{diamond_pickaxe:1,netherite_ingot:1},gives:{netherite_pickaxe:1}},
  bow:{name:"Arco",icon:"ğŸ¹",cat:"weapons",req:{oak_log:3,string:3},gives:{bow:1}},
  arrow:{name:"Flechas x16",icon:"â†‘",cat:"weapons",req:{flint:1,oak_log:1,feather:1},gives:{arrow:16}},
  shield:{name:"Escudo",icon:"ğŸ›¡",cat:"weapons",req:{planks:6,iron_ingot:1},gives:{shield:1}},
  bread:{name:"PÃ£o",icon:"ğŸ",cat:"food",req:{wheat:3},gives:{bread:1}},
  golden_apple:{name:"MaÃ§Ã£ Dourada",icon:"ğŸ",cat:"food",req:{apple:1,gold_ingot:8},gives:{golden_apple:1}},
  mushroom_stew:{name:"Ensopado Cogumelo",icon:"ğŸ²",cat:"food",req:{red_mushroom:1,brown_mushroom:1,bowl:1},gives:{mushroom_stew:1}},
  bucket:{name:"Balde",icon:"ğŸª£",cat:"tools",req:{iron_ingot:3},gives:{bucket:1}},
  compass:{name:"BÃºssola",icon:"ğŸ§­",cat:"tools",req:{iron_ingot:4,redstone_ore:1},gives:{compass:1}},
  fishing_rod:{name:"Vara de Pescar",icon:"ğŸ£",cat:"tools",req:{oak_log:3,string:2},gives:{fishing_rod:1}},
  bowl:{name:"Tigela x4",icon:"ğŸ¥£",cat:"resources",req:{planks:3},gives:{bowl:4}},
  book:{name:"Livro",icon:"ğŸ“–",cat:"tools",req:{leather:1,sugar:3,feather:1},gives:{book:1}},
};

const WORLD_OBJECTS = {
  tree:{icon:"ğŸŒ²",w:2,h:2,hp:5,loot:"oak_log",lootMin:3,lootMax:6,biomes:["PLAINS","FOREST","TAIGA"],chance:.06},
  birch:{icon:"ğŸŒ³",w:2,h:2,hp:4,loot:"birch_log",lootMin:3,lootMax:5,biomes:["FOREST","PLAINS"],chance:.04},
  jungle_tree:{icon:"ğŸŒ´",w:2,h:3,hp:6,loot:"jungle_log",lootMin:4,lootMax:8,biomes:["JUNGLE"],chance:.1},
  acacia:{icon:"ğŸŒµ",w:2,h:2,hp:4,loot:"acacia_log",lootMin:2,lootMax:5,biomes:["SAVANNA","DESERT"],chance:.05},
  stone_rock:{icon:"ğŸª¨",w:1,h:1,hp:8,loot:"cobblestone",lootMin:2,lootMax:5,biomes:["PLAINS","FOREST","SNOW","TAIGA"],chance:.04},
  iron_rock:{icon:"ğŸŸ«",w:1,h:1,hp:12,loot:"iron_ore",lootMin:1,lootMax:3,biomes:["PLAINS","FOREST","SNOW","TAIGA"],chance:.02},
  coal_rock:{icon:"â¬›",w:1,h:1,hp:8,loot:"coal_ore",lootMin:2,lootMax:4,biomes:["PLAINS","FOREST","TAIGA"],chance:.025},
  gold_rock:{icon:"ğŸŸ¡",w:1,h:1,hp:14,loot:"gold_ore",lootMin:1,lootMax:2,biomes:["DESERT","SAVANNA"],chance:.01},
  diamond_rock:{icon:"ğŸ’",w:1,h:1,hp:20,loot:"diamond_ore",lootMin:1,lootMax:2,biomes:["FOREST","TAIGA","SNOW"],chance:.005},
  emerald_rock:{icon:"ğŸ’š",w:1,h:1,hp:20,loot:"emerald_ore",lootMin:1,lootMax:2,biomes:["JUNGLE","FOREST"],chance:.004},
  sand_patch:{icon:"ğŸ–",w:1,h:1,hp:2,loot:"sand",lootMin:3,lootMax:6,biomes:["DESERT","OCEAN"],chance:.1},
  bush:{icon:"ğŸ«",w:1,h:1,hp:2,loot:"apple",lootMin:1,lootMax:2,biomes:["PLAINS","FOREST"],chance:.03},
  mushroom:{icon:"ğŸ„",w:1,h:1,hp:1,loot:"red_mushroom",lootMin:1,lootMax:2,biomes:["MUSHROOM","FOREST"],chance:.05},
  wheat_field:{icon:"ğŸŒ¾",w:1,h:1,hp:1,loot:"wheat",lootMin:1,lootMax:3,biomes:["PLAINS","SAVANNA"],chance:.04},
  sugarcane:{icon:"ğŸŒ¿",w:1,h:1,hp:2,loot:"sugar_cane",lootMin:1,lootMax:3,biomes:["OCEAN","PLAINS"],chance:.03},
  wool_sheep:{icon:"ğŸ‘",w:1,h:1,hp:6,loot:"wool",lootMin:1,lootMax:3,biomes:["PLAINS","SAVANNA"],chance:.015},
};

const MOB_TYPES = {
  zombie:{name:"Zumbi",icon:"ğŸ§Ÿ",hp:20,damage:4,speed:1.2,xp:5,loot:[{id:"iron_ingot",c:.3},{id:"bone",c:.6}]},
  skeleton:{name:"Esqueleto",icon:"ğŸ’€",hp:20,damage:5,speed:1.5,xp:5,loot:[{id:"bone",c:.8},{id:"arrow",c:.5}]},
  spider:{name:"Aranha",icon:"ğŸ•·",hp:16,damage:3,speed:2.5,xp:4,loot:[{id:"string",c:.7}]},
  creeper:{name:"Creeper",icon:"ğŸ’£",hp:20,damage:25,speed:1.8,xp:7,loot:[{id:"gunpowder",c:.8}]},
  enderman:{name:"Enderman",icon:"ğŸ‘",hp:40,damage:10,speed:2,xp:15,loot:[{id:"diamond_ore",c:.3}]},
  slime:{name:"Slime",icon:"ğŸŸ¢",hp:12,damage:3,speed:1.5,xp:3,loot:[{id:"slimeball",c:.8}]},
};

const BIOME_DATA = {
  PLAINS:{name:"PlanÃ­cies",col:["#4a7a3a","#5a8a4a","#3a6a2a","#6a9a5a"]},
  FOREST:{name:"Floresta",col:["#2a5a2a","#1a4a1a","#3a6a3a","#2a5a2a"]},
  DESERT:{name:"Deserto",col:["#c8a050","#d4b060","#b89040","#e0bc70"]},
  SNOW:{name:"Tundra",col:["#c8d8e8","#d8e8f8","#b8c8d8","#e0ecf8"]},
  JUNGLE:{name:"Selva",col:["#1a6a1a","#0a5a0a","#2a7a2a","#0a6a0a"]},
  SAVANNA:{name:"Savana",col:["#9a8040","#8a7030","#b09050","#a09040"]},
  TAIGA:{name:"Taiga",col:["#3a5a3a","#2a4a2a","#4a6a4a","#2a5a2a"]},
  MUSHROOM:{name:"Ilha Cogumelo",col:["#6a2a5a","#5a1a4a","#7a3a6a","#8a4a7a"]},
  OCEAN:{name:"Oceano",col:["#1a3a8a","#0a2a7a","#2a4a9a","#1a3a8a"]},
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERLIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class Perlin{
  constructor(seed=42){this.p=[];const s=this._lcg(seed);for(let i=0;i<256;i++)this.p.push(i);for(let i=255;i>0;i--){const j=Math.floor(s()*(i+1));[this.p[i],this.p[j]]=[this.p[j],this.p[i]];}this.p=[...this.p,...this.p];}
  _lcg(seed){let s=seed|0;return()=>{s=(s*1664525+1013904223)|0;return(s>>>0)/4294967296};}
  fade(t){return t*t*t*(t*(t*6-15)+10);}
  lerp(a,b,t){return a+t*(b-a);}
  grad(h,x,y){const u=h<2?x:y,v=h<2?y:x;return((h&1)?-u:u)+((h&2)?-v:v);}
  noise(x,y){const X=Math.floor(x)&255,Y=Math.floor(y)&255;x-=Math.floor(x);y-=Math.floor(y);const u=this.fade(x),v=this.fade(y);const a=this.p[X]+Y,b=this.p[X+1]+Y;return this.lerp(this.lerp(this.grad(this.p[a]&3,x,y),this.grad(this.p[b]&3,x-1,y),u),this.lerp(this.grad(this.p[a+1]&3,x,y-1),this.grad(this.p[b+1]&3,x-1,y-1),u),v);}
  oct(x,y,o=4,p=.5){let v=0,a=1,f=1,m=0;for(let i=0;i<o;i++){v+=this.noise(x*f,y*f)*a;m+=a;a*=p;f*=2;}return v/m;}
}
const perlin = new Perlin(42);

function getBiome(wx,wy){
  const s=.003;const t=perlin.oct(wx*s,wy*s);const m=perlin.oct(wx*s+100,wy*s+100);
  if(m>.3)return"OCEAN";if(t>.4)return"SNOW";if(t>.2)return"TAIGA";if(t<-.4)return"DESERT";if(t<-.2)return"SAVANNA";
  const j=perlin.oct(wx*s+200,wy*s+200);if(j>.3)return"JUNGLE";if(j<-.3)return"MUSHROOM";
  if(perlin.oct(wx*s+300,wy*s+300)>.15)return"FOREST";return"PLAINS";
}
function getTileColor(wx,wy){const b=getBiome(wx,wy);const info=BIOME_DATA[b];const n=perlin.oct(wx*.05,wy*.05);const idx=Math.floor(((n+1)/2)*info.col.length)%info.col.length;return info.col[idx];}

const CHUNK=16,TILE=48;
function seededRNG(seed){let s=(seed^0x12345678)>>>0;return()=>{s=(s*1664525+1013904223)>>>0;return s/4294967296};}
const chunkCache={};
function getChunk(cx,cy){
  const key=`${cx},${cy}`;if(chunkCache[key])return chunkCache[key];
  const objs=[];const rng=seededRNG(cx*73856093^cy*19349663);
  for(let tx=0;tx<CHUNK;tx++)for(let ty=0;ty<CHUNK;ty++){
    const wx=cx*CHUNK+tx,wy=cy*CHUNK+ty;const biome=getBiome(wx,wy);
    for(const [id,def] of Object.entries(WORLD_OBJECTS)){
      if(!def.biomes.includes(biome))continue;
      if(rng()<def.chance){objs.push({id,def,wx,wy,hp:def.hp,maxHp:def.hp,dead:false});break;}
    }
  }
  return chunkCache[key]={objs};
}
function getVisibleChunks(camX,camY,W,H){
  const cx0=Math.floor((camX-W/2)/(CHUNK*TILE)),cy0=Math.floor((camY-H/2)/(CHUNK*TILE));
  const cx1=Math.ceil((camX+W/2)/(CHUNK*TILE)),cy1=Math.ceil((camY+H/2)/(CHUNK*TILE));
  const r=[];for(let cx=cx0;cx<=cx1;cx++)for(let cy=cy0;cy<=cy1;cy++)r.push(getChunk(cx,cy));
  return r;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTADO DO JOGO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MAX_STACK = 64;
const INV_SIZE  = 36;

const G = {
  // Rede
  ws: null, myId: null, connected: false,
  // Jogador local
  player: { id:null,name:'',x:0,y:0,hp:80,maxHp:80,hunger:100,xp:0,level:1,kills:0,deaths:0,class_id:0,speed:3 },
  // InventÃ¡rio: array de 36 slots. Cada slot: null ou {item_id, count}
  inv: Array(INV_SIZE).fill(null),
  hotbar: Array(10).fill(null),
  hotbarIdx: 0,
  // Outros jogadores (do servidor)
  otherPlayers: new Map(),
  // Mobs locais
  mobs: [],
  drops: [],
  particles: [],
  buildings: [],
  // Render
  canvas: null, ctx: null, mmc: null, mmctx: null, W:0, H:0,
  camera: {x:0,y:0},
  // Input
  keys: {}, mouse: {x:0,y:0,down:false},
  // Estado
  tick: 0, time: 0, day: 1, dayPhase: 'day',
  dead: false,
  invOpen: false, craftOpen: false, buildOpen: false,
  invTab: 'all', craftCat: 'all', craftFilter: '',
  selectedBuild: null,
  attackCd: 0,
  classes: [],
  // CLASSES locais (preenchido pelo server)
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INVENTÃRIO (client-side, espelha servidor)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function invAdd(itemId, count) {
  let remaining = count;
  // Empilha em slots existentes
  for (let s = 0; s < INV_SIZE && remaining > 0; s++) {
    if (G.inv[s] && G.inv[s].item_id === itemId && G.inv[s].count < MAX_STACK) {
      const space = MAX_STACK - G.inv[s].count;
      const add = Math.min(space, remaining);
      G.inv[s].count += add;
      remaining -= add;
    }
  }
  // Abre novos slots
  for (let s = 0; s < INV_SIZE && remaining > 0; s++) {
    if (!G.inv[s]) {
      const add = Math.min(MAX_STACK, remaining);
      G.inv[s] = { item_id: itemId, count: add };
      remaining -= add;
    }
  }
  updateHotbarUI();
  return remaining === 0;
}
function invRemove(itemId, count) {
  let toRemove = count;
  for (let s = 0; s < INV_SIZE && toRemove > 0; s++) {
    if (G.inv[s] && G.inv[s].item_id === itemId) {
      const r = Math.min(G.inv[s].count, toRemove);
      G.inv[s].count -= r; toRemove -= r;
      if (G.inv[s].count === 0) G.inv[s] = null;
    }
  }
}
function invCount(itemId) {
  return G.inv.reduce((t,s)=>t+(s&&s.item_id===itemId?s.count:0),0);
}
// Sincroniza com o servidor
function syncInvFromServer(arr) {
  G.inv = arr.map(s => s ? { item_id: s.item_id, count: s.count } : null);
  updateHotbarUI();
  if (G.invOpen) refreshInvUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WEBSOCKET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function connectWS() {
  const proto = location.protocol === 'https:' ? 'wss' : 'ws';
  const host = location.host; // mesmo host do servidor
  G.ws = new WebSocket(`${proto}://${host}`);

  G.ws.onopen = () => {
    G.connected = true;
    document.getElementById('online-badge').textContent = 'ğŸŸ¢ SERVIDOR ONLINE';
    console.log('[WS] Conectado');
  };

  G.ws.onclose = () => {
    G.connected = false;
    document.getElementById('online-badge').textContent = 'ğŸ”´ DESCONECTADO â€” recarregue';
    console.log('[WS] Desconectado');
  };

  G.ws.onerror = () => {
    document.getElementById('online-badge').textContent = 'ğŸ”´ ERRO DE CONEXÃƒO';
  };

  G.ws.onmessage = (e) => {
    let d; try { d = JSON.parse(e.data); } catch { return; }
    handleServerMsg(d);
  };
}

function wsSend(obj) {
  if (G.ws && G.ws.readyState === WebSocket.OPEN) G.ws.send(JSON.stringify(obj));
}

function handleServerMsg(d) {
  switch(d.type) {
    case 'init':
      G.myId = d.id;
      Object.assign(G.player, d.player);
      G.classes = d.classes || [];
      syncInvFromServer(d.inv);
      G.hotbar = d.hotbar || Array(10).fill(null);
      updateHUD();
      updatePlayerPanel();
      showNotif('âš” Entrou no servidor!','notif-craft');
      break;
    case 'players_init':
      d.players.forEach(p => G.otherPlayers.set(p.id, p));
      break;
    case 'player_join':
      G.otherPlayers.set(d.player.id, d.player);
      break;
    case 'player_leave':
      G.otherPlayers.delete(d.id);
      break;
    case 'player_move':
      if (G.otherPlayers.has(d.id)) { G.otherPlayers.get(d.id).x = d.x; G.otherPlayers.get(d.id).y = d.y; }
      break;
    case 'player_update':
      G.otherPlayers.set(d.player.id, d.player);
      break;
    case 'inv_update':
      syncInvFromServer(d.inv);
      if (d.notification) showNotif(d.notification);
      break;
    case 'craft_ok':
      syncInvFromServer(d.inv);
      G.player.xp = d.xp;
      if (d.notification) showNotif(d.notification, 'notif-craft');
      refreshCraftUI();
      updateHUD();
      break;
    case 'attack_ok':
      break;
    case 'take_damage':
      G.player.hp -= d.dmg;
      if (G.player.hp < 0) G.player.hp = 0;
      showNotif(`ğŸ’¢ -${d.dmg} HP por ${d.fromName}`, 'notif-dmg');
      spawnParticles(G.player.x, G.player.y, '#ff4444', 6);
      updateHUD();
      break;
    case 'kill_confirm':
      G.player.kills = d.kills;
      G.player.xp = d.xp;
      const prevClass = G.player.class_id;
      G.player.class_id = d.class_id;
      G.player.maxHp = d.maxHp;
      G.player.hp = d.hp;
      showNotif(d.notification, 'notif-kill');
      if (d.class_id !== prevClass) showClassPopup(d.class_id);
      updateHUD();
      updatePlayerPanel();
      break;
    case 'you_died':
      G.dead = true;
      G.player.x = d.x; G.player.y = d.y;
      G.player.hp = d.hp;
      document.getElementById('death-msg').textContent = 'Morto por: ' + d.killerName;
      document.getElementById('death-screen').classList.add('show');
      break;
    case 'stats_update':
      G.player.hp = d.hp;
      G.player.hunger = d.hunger;
      if (d.inv) syncInvFromServer(d.inv);
      updateHUD();
      break;
    case 'chat':
      addChat(d.name, d.msg, d.sys ? 'sys' : d.pvp ? 'pvp' : 'normal');
      break;
    case 'leaderboard':
      renderLeaderboard(d.data);
      break;
    case 'online_count':
      document.getElementById('online-badge') && (document.getElementById('online-badge').textContent = `ğŸŸ¢ ${d.count} JOGADORES ONLINE`);
      break;
    case 'building_placed':
      G.buildings.push(d);
      break;
    case 'error':
      showNotif('âš  ' + d.msg, 'notif-dmg');
      break;
    case 'pong': break;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HUD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateHUD() {
  const p = G.player;
  document.getElementById('cx').textContent = Math.floor(p.x/TILE);
  document.getElementById('cy').textContent = Math.floor(p.y/TILE);
  document.getElementById('biome-name').textContent = BIOME_DATA[getBiome(Math.floor(p.x/TILE),Math.floor(p.y/TILE))]?.name||'?';
  document.getElementById('day-num').textContent = G.day;
  document.getElementById('time-str').textContent = G.dayPhase==='day'?'â˜€ Dia':'ğŸŒ™ Noite';
  document.getElementById('hp-fill').style.width = (p.hp/p.maxHp*100)+'%';
  document.getElementById('hp-val').textContent = Math.ceil(p.hp);
  document.getElementById('hunger-fill').style.width = (p.hunger/100*100)+'%';
  document.getElementById('hunger-val').textContent = Math.ceil(p.hunger);
  document.getElementById('xp-fill').style.width = Math.min(100,(p.xp/100)*100)+'%';
  document.getElementById('xp-val').textContent = p.xp;
}

function updatePlayerPanel() {
  const p = G.player;
  const classes = G.classes.length ? G.classes : [{id:0,name:'AldeÃ£o',icon:'ğŸ§‘',desc:'O inÃ­cio',kills:0}];
  const cls = classes[p.class_id] || classes[0];
  const nextCls = classes[p.class_id+1];
  document.getElementById('pp-icon').textContent = cls.icon;
  document.getElementById('pp-name').textContent = cls.name;
  document.getElementById('pp-desc').textContent = cls.desc;
  document.getElementById('pp-kills').textContent = p.kills;
  document.getElementById('pp-deaths').textContent = p.deaths;
  if(nextCls){
    document.getElementById('pp-next').textContent = `${nextCls.kills} kills`;
    const pct = Math.min(100,((p.kills-cls.kills)/(nextCls.kills-cls.kills)*100));
    document.getElementById('pp-kills-fill').style.width = pct+'%';
  } else {
    document.getElementById('pp-next').textContent = 'MÃXIMO!';
    document.getElementById('pp-kills-fill').style.width = '100%';
  }
}

function showClassPopup(classId) {
  const cls = (G.classes.length ? G.classes : [])[classId];
  if (!cls) return;
  const popup = document.getElementById('class-popup');
  document.getElementById('cp-icon').textContent = cls.icon;
  document.getElementById('cp-name').textContent = cls.name;
  document.getElementById('cp-desc').textContent = cls.desc;
  popup.style.display = 'block';
  setTimeout(() => { popup.style.display = 'none'; }, 3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICAÃ‡Ã•ES (lado direito)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showNotif(msg, extraClass='') {
  const c = document.getElementById('notifs');
  const d = document.createElement('div');
  d.className = 'notif' + (extraClass ? ' '+extraClass : '');
  d.textContent = msg;
  c.appendChild(d);
  setTimeout(() => d.remove(), 3200);
  // MÃ¡x 6 visÃ­veis
  while (c.children.length > 6) c.removeChild(c.firstChild);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOTBAR UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateHotbarUI() {
  const hb = document.getElementById('hotbar');
  hb.innerHTML = '';
  G.hotbar.forEach((id, i) => {
    const d = document.createElement('div');
    d.className = 'slot' + (i === G.hotbarIdx ? ' active' : '');
    d.innerHTML = `<span class="slot-num">${i===9?0:i+1}</span>`;
    if (id) {
      const it = ITEMS_DB[id];
      const cnt = invCount(id);
      if (cnt > 0) {
        d.innerHTML += `<span class="item-icon">${it?.icon||'?'}</span><span class="item-count">${cnt}</span>`;
      } else {
        d.innerHTML += `<span class="item-icon" style="opacity:.3">${it?.icon||'?'}</span>`;
      }
    }
    d.addEventListener('click', () => { G.hotbarIdx = i; updateHotbarUI(); });
    d.addEventListener('mouseenter', e => showTooltip(e, id));
    d.addEventListener('mouseleave', hideTooltip);
    hb.appendChild(d);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOOLTIP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTooltip(e, id) {
  if (!id) return;
  const it = ITEMS_DB[id];
  if (!it) return;
  const t = document.getElementById('tooltip');
  let h = `<h5>${it.icon||''} ${it.name||id}</h5>`;
  if (it.damage)    h += `<div class="tstat">âš” Dano: ${it.damage}</div>`;
  if (it.defense)   h += `<div class="tstat">ğŸ›¡ Defesa: +${it.defense}</div>`;
  if (it.hunger)    h += `<div class="tstat">ğŸ– Fome: +${it.hunger}</div>`;
  if (it.hp)        h += `<div class="tstat">â¤ HP: +${it.hp}</div>`;
  if (it.efficiency)h += `<div class="tstat">â› EficiÃªncia: Ã—${it.efficiency}</div>`;
  h += `<div class="tstat">Qtd no inv: ${invCount(id)}</div>`;
  const rec = RECIPES[id];
  if (rec) { h += `<div class="tcraft">âš’ CraftÃ¡vel</div>`; }
  t.innerHTML = h;
  t.style.display = 'block';
  t.style.left = Math.min(e.clientX + 14, window.innerWidth - 225) + 'px';
  t.style.top  = Math.min(e.clientY - 10, window.innerHeight - 180) + 'px';
}
function hideTooltip() { document.getElementById('tooltip').style.display = 'none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INVENTÃRIO UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleInventory() {
  G.invOpen = !G.invOpen;
  document.getElementById('inventory-screen').classList.toggle('open', G.invOpen);
  if (G.invOpen) refreshInvUI();
}
function invTab(tab, btn) {
  G.invTab = tab;
  document.querySelectorAll('.inv-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  refreshInvUI();
}
function refreshInvUI() {
  const grid = document.getElementById('inv-grid');
  grid.innerHTML = '';
  for (let s = 0; s < INV_SIZE; s++) {
    const slot = G.inv[s];
    const d = document.createElement('div');
    if (!slot) {
      d.className = 'inv-slot empty';
      grid.appendChild(d);
      continue;
    }
    const it = ITEMS_DB[slot.item_id];
    if (G.invTab !== 'all' && it?.cat !== G.invTab) { d.className='inv-slot empty'; grid.appendChild(d); continue; }
    d.className = 'inv-slot';
    d.innerHTML = `<span class="item-icon">${it?.icon||'ğŸ“¦'}</span>
      <span class="item-count">${slot.count}</span>
      <span class="item-name">${it?.name||slot.item_id}</span>`;
    d.addEventListener('click', () => useItem(slot.item_id));
    d.addEventListener('mouseenter', e => showTooltip(e, slot.item_id));
    d.addEventListener('mouseleave', hideTooltip);
    grid.appendChild(d);
  }
}
function useItem(itemId) {
  const it = ITEMS_DB[itemId];
  if (!it) return;
  if (it.hunger) {
    // Come o item â€” envia ao servidor
    wsSend({ type: 'eat', itemId, hunger: it.hunger, hpGain: it.hp || 0 });
    return;
  }
  // Coloca na hotbar
  const empty = G.hotbar.indexOf(null);
  const idx = empty >= 0 ? empty : G.hotbarIdx;
  G.hotbar[idx] = itemId;
  wsSend({ type: 'hotbar', hotbar: G.hotbar });
  updateHotbarUI();
  showNotif(`âœ‹ ${it.name} equipado`, 'notif-craft');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CRAFT UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CRAFT_CATS = ['all','tools','weapons','blocks','food','resources'];
function toggleCraft() {
  G.craftOpen = !G.craftOpen;
  document.getElementById('craft-screen').classList.toggle('open', G.craftOpen);
  if (G.craftOpen) refreshCraftUI();
}
function filterCraft() { G.craftFilter = document.getElementById('craft-search').value.toLowerCase(); refreshCraftUI(); }
function refreshCraftUI() {
  // Categorias
  const cc = document.getElementById('craft-cats');
  cc.innerHTML = '';
  CRAFT_CATS.forEach(c => {
    const b = document.createElement('button');
    b.className = 'craft-cat' + (G.craftCat===c?' active':'');
    b.textContent = c.toUpperCase();
    b.onclick = () => { G.craftCat=c; refreshCraftUI(); };
    cc.appendChild(b);
  });
  // Lista
  const cl = document.getElementById('craft-list');
  cl.innerHTML = '';
  for (const [id, rec] of Object.entries(RECIPES)) {
    if (G.craftCat !== 'all' && rec.cat !== G.craftCat) continue;
    if (G.craftFilter && !rec.name.toLowerCase().includes(G.craftFilter)) continue;
    const can = canCraftLocal(rec);
    const d = document.createElement('div');
    d.className = 'craft-item' + (can?' can':'');
    let reqs = '';
    for (const [iid,n] of Object.entries(rec.req)) {
      const cnt = invCount(iid);
      const it = ITEMS_DB[iid];
      reqs += `<span class="${cnt>=n?'has':'lacks'}">${it?.icon||''} ${it?.name||iid}: ${cnt}/${n}</span><br>`;
    }
    d.innerHTML = `<div class="craft-icon">${rec.icon||'ğŸ“¦'}</div>
      <div class="craft-info">
        <h4>${rec.name}</h4>
        <div class="craft-reqs">${reqs}</div>
        <button class="craft-do" ${can?'':'disabled'} onclick="craftItem('${id}')">âš’ CRAFTAR</button>
      </div>`;
    cl.appendChild(d);
  }
}
function canCraftLocal(rec) {
  for(const [id,n] of Object.entries(rec.req)) if(invCount(id)<n) return false;
  return true;
}
function craftItem(id) {
  wsSend({ type: 'craft', recipeId: id });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUILD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BUILD_ITEMS = ['planks','stone_wall','glass','torch','chest','door','crafting_table','furnace','ladder'];
function toggleBuild() {
  G.buildOpen = !G.buildOpen;
  document.getElementById('build-panel').classList.toggle('open', G.buildOpen);
  refreshBuildUI();
}
function refreshBuildUI() {
  const bg = document.getElementById('build-grid');
  bg.innerHTML = '';
  BUILD_ITEMS.forEach(id => {
    const it = ITEMS_DB[id];
    const cnt = invCount(id);
    const d = document.createElement('div');
    d.className = 'build-slot' + (G.selectedBuild===id?' sel':'');
    d.innerHTML = `<span class="item-icon">${it?.icon||'?'}</span><span class="bcount">${cnt}</span>`;
    d.onclick = () => { G.selectedBuild = G.selectedBuild===id?null:id; refreshBuildUI(); };
    d.addEventListener('mouseenter', e => showTooltip(e, id));
    d.addEventListener('mouseleave', hideTooltip);
    bg.appendChild(d);
  });
}
function dropSelected() {
  const cur = G.hotbar[G.hotbarIdx];
  if (cur && invCount(cur) > 0) {
    invRemove(cur, 1);
    G.drops.push({id:cur,x:G.player.x+(Math.random()-.5)*60,y:G.player.y+(Math.random()-.5)*60,life:400});
    showNotif(`Dropou: ${ITEMS_DB[cur]?.name||cur}`);
    updateHotbarUI();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sendChat() {
  const inp = document.getElementById('chat-input');
  const msg = inp.value.trim();
  if (!msg) return;
  inp.value = '';
  wsSend({ type: 'chat', msg });
}
function addChat(name, msg, type='normal') {
  const c = document.getElementById('chat-msgs');
  const d = document.createElement('div');
  d.className = 'chat-msg' + (type==='sys'?' sys':type==='pvp'?' pvp':'');
  d.innerHTML = type==='sys' ? msg : `<span class="cn">${name}:</span> ${msg}`;
  c.appendChild(d);
  c.scrollTop = c.scrollHeight;
  while (c.children.length > 50) c.removeChild(c.firstChild);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEADERBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLeaderboard(data) {
  const lb = document.getElementById('lb-list');
  lb.innerHTML = data.slice(0,8).map((e,i) => {
    const cls_icon = G.classes[e.class_id]?.icon || 'ğŸ§‘';
    const me = e.id === G.myId;
    return `<div class="lb-row${me?' lb-me':''}">
      <span class="lb-rank">${i+1}</span>
      <span class="lb-class">${cls_icon}</span>
      <span style="flex:1">${e.name}</span>
      <span>${e.kills}</span>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESPAWN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function requestRespawn() {
  G.dead = false;
  G.player.hp = G.player.maxHp;
  G.player.hunger = 100;
  document.getElementById('death-screen').classList.remove('show');
  showNotif('â†º Renasceu!', 'notif-craft');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MUNDO â€” MOBS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnMobs(n=6) {
  for (let i=0;i<n;i++) {
    const types=Object.keys(MOB_TYPES);
    const t=MOB_TYPES[types[Math.floor(Math.random()*types.length)]];
    const a=Math.random()*Math.PI*2,d=600+Math.random()*1200;
    G.mobs.push({...t,id:Date.now()+i,x:G.player.x+Math.cos(a)*d,y:G.player.y+Math.sin(a)*d,maxHp:t.hp,angle:0,atkCd:0});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTERAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tryInteract() {
  if (G.attackCd > 0 || G.dead) return;
  const p = G.player;
  const range = 80;

  // Mobs
  for (const mob of G.mobs) {
    if (Math.hypot(mob.x-p.x, mob.y-p.y) < range) { attackMob(mob); return; }
  }
  // Outros jogadores
  for (const [id, op] of G.otherPlayers) {
    if (Math.hypot(op.x-p.x, op.y-p.y) < range) { wsSend({type:'attack',targetId:id}); G.attackCd=20; return; }
  }
  // Objetos do mundo
  const chunks = getVisibleChunks(G.camera.x,G.camera.y,G.W,G.H);
  let best=null,bestD=range;
  for (const ch of chunks) for (const obj of ch.objs) {
    if (obj.dead) continue;
    const dd=Math.hypot(obj.wx*TILE-p.x,obj.wy*TILE-p.y);
    if (dd<bestD){bestD=dd;best=obj;}
  }
  if (best) harvestObj(best);
}

function getEquipEff() {
  const eq = G.hotbar[G.hotbarIdx];
  if (!eq) return 1;
  return ITEMS_DB[eq]?.efficiency || 1;
}
function getEquipDmg() {
  const eq = G.hotbar[G.hotbarIdx];
  if (!eq) return 1;
  return ITEMS_DB[eq]?.damage || 1;
}

function harvestObj(obj) {
  const eff = getEquipEff();
  obj.hp -= eff;
  G.attackCd = 12;
  spawnParticles(obj.wx*TILE, obj.wy*TILE, '#f0a020', 4);
  if (obj.hp <= 0) {
    obj.dead = true;
    const cnt = obj.def.lootMin + Math.floor(Math.random()*(obj.def.lootMax-obj.def.lootMin+1));
    // Informa ao servidor
    wsSend({ type:'harvest', objKey:`${obj.wx},${obj.wy}`, loot:obj.def.loot, lootCount:cnt });
    spawnParticles(obj.wx*TILE, obj.wy*TILE, '#88ff44', 8);
    setTimeout(()=>{ obj.hp=obj.maxHp; obj.dead=false; }, 30000+Math.random()*60000);
  }
}

function attackMob(mob) {
  const dmg = getEquipDmg();
  mob.hp -= dmg;
  G.attackCd = 18;
  spawnParticles(mob.x, mob.y, '#ff4444', 6);
  if (mob.hp <= 0) {
    const idx = G.mobs.indexOf(mob);
    if (idx>=0) G.mobs.splice(idx,1);
    showNotif(`ğŸ’€ Matou ${mob.name}!`, 'notif-kill');
    spawnParticles(mob.x, mob.y, '#ff8800', 12);
    for (const l of (mob.loot||[])) if(Math.random()<l.c) invAdd(l.id,1);
    updateHotbarUI();
    if (G.invOpen) refreshInvUI();
    setTimeout(()=>spawnMobs(1), 15000);
  }
}

function placeBlock(wx, wy) {
  if (!G.selectedBuild || invCount(G.selectedBuild)<1) { showNotif('Sem item para construir!','notif-dmg'); return; }
  wsSend({ type:'build', itemId:G.selectedBuild, wx, wy });
  spawnParticles(wx*TILE, wy*TILE, '#c0c0c0', 6);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTÃCULAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnParticles(x, y, color, n=8) {
  for(let i=0;i<n;i++){
    const a=Math.random()*Math.PI*2,s=1+Math.random()*4;
    G.particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,color,life:30+Math.random()*20,maxLife:50,size:3+Math.random()*4});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function update() {
  if (G.dead) return;
  G.tick++;
  const p = G.player;
  // Movimento
  let dx=0,dy=0;
  if(G.keys['w']||G.keys['ArrowUp'])dy-=1;
  if(G.keys['s']||G.keys['ArrowDown'])dy+=1;
  if(G.keys['a']||G.keys['ArrowLeft'])dx-=1;
  if(G.keys['d']||G.keys['ArrowRight'])dx+=1;
  if(dx||dy){const d=Math.hypot(dx,dy);p.x+=dx/d*p.speed;p.y+=dy/d*p.speed;}
  // Envia posiÃ§Ã£o ao servidor a cada 3 ticks
  if(G.tick%3===0&&G.connected) wsSend({type:'move',x:p.x,y:p.y});
  // Attack hold
  if(G.mouse.down&&!G.invOpen&&!G.craftOpen) tryInteract();
  if(G.attackCd>0) G.attackCd--;
  // Camera
  G.camera.x += (p.x-G.camera.x)*.12;
  G.camera.y += (p.y-G.camera.y)*.12;
  // Ciclo dia/noite
  G.time += .0005;
  const dayT = G.time%1;
  const wasDay = G.dayPhase==='day';
  G.dayPhase = dayT<.6?'day':'night';
  if(wasDay&&G.dayPhase==='night'){G.day++;spawnMobs(3);}
  // Mobs
  G.mobs.forEach(mob=>{
    const dx2=p.x-mob.x,dy2=p.y-mob.y,dist=Math.hypot(dx2,dy2);
    if(dist<500){mob.x+=dx2/dist*mob.speed;mob.y+=dy2/dist*mob.speed;}
    else{const a=mob.angle+(Math.random()-.5)*.3;mob.angle=a;mob.x+=Math.cos(a);mob.y+=Math.sin(a);}
    mob.atkCd--;
    if(dist<50&&mob.atkCd<=0){
      mob.atkCd=60;
      const dmg=Math.max(1,mob.damage-2);
      p.hp-=dmg;
      showNotif(`ğŸ’¢ -${dmg} HP por ${mob.name}`,'notif-dmg');
      spawnParticles(p.x,p.y,'#ff2200',5);
      if(p.hp<=0){G.dead=true;G.player.hp=0;document.getElementById('death-msg').textContent='Morto por: '+mob.name;document.getElementById('death-screen').classList.add('show');}
      updateHUD();
    }
  });
  // Drops
  G.drops=G.drops.filter(d=>{d.life--;if(Math.hypot(d.x-p.x,d.y-p.y)<55){invAdd(d.id,1);updateHotbarUI();return false;}return d.life>0;});
  // PartÃ­culas
  G.particles=G.particles.filter(pt=>{pt.x+=pt.vx;pt.y+=pt.vy;pt.vy+=.1;pt.life--;pt.vx*=.95;return pt.life>0;});
  // HUD
  updateHUD();
  // Ping a cada 5s
  if(G.tick%100===0) wsSend({type:'ping',t:Date.now()});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
  const c=G.ctx,W=G.W,H=G.H;
  const cam=G.camera;
  c.clearRect(0,0,W,H);
  // Terreno
  const ts=Math.floor((cam.x-W/2)/TILE),te=Math.floor((cam.y-H/2)/TILE);
  const te2=Math.ceil((cam.x+W/2)/TILE),te3=Math.ceil((cam.y+H/2)/TILE);
  for(let ty=te;ty<=te3;ty++)for(let tx=ts;tx<=te2;tx++){
    const sx=tx*TILE-cam.x+W/2,sy=ty*TILE-cam.y+H/2;
    c.fillStyle=getTileColor(tx,ty);c.fillRect(sx,sy,TILE,TILE);
    c.strokeStyle='rgba(0,0,0,.07)';c.strokeRect(sx,sy,TILE,TILE);
  }
  // Blocos construÃ­dos
  for(const b of G.buildings){
    const sx=b.wx*TILE-cam.x+W/2,sy=b.wy*TILE-cam.y+H/2;
    if(sx<-TILE||sx>W+TILE||sy<-TILE||sy>H+TILE)continue;
    c.fillStyle='#5a4020';c.fillRect(sx,sy,TILE,TILE);
    c.strokeStyle='rgba(0,0,0,.4)';c.strokeRect(sx,sy,TILE,TILE);
    c.font=`${TILE*.6}px serif`;c.textAlign='center';c.textBaseline='middle';
    c.fillText(ITEMS_DB[b.itemId]?.icon||'?',sx+TILE/2,sy+TILE/2);
  }
  // Objetos do mundo
  c.font=`${TILE*.65}px serif`;c.textAlign='center';c.textBaseline='middle';
  const chunks=getVisibleChunks(cam.x,cam.y,W,H);
  for(const ch of chunks)for(const obj of ch.objs){
    if(obj.dead)continue;
    const sx=obj.wx*TILE-cam.x+W/2,sy=obj.wy*TILE-cam.y+H/2;
    if(sx<-TILE*3||sx>W+TILE*3||sy<-TILE*3||sy>H+TILE*3)continue;
    c.fillStyle='rgba(0,0,0,.2)';c.beginPath();c.ellipse(sx+TILE/2,sy+TILE*obj.def.h*.88,TILE*.38,TILE*.13,0,0,Math.PI*2);c.fill();
    const fs=TILE*Math.max(obj.def.w,obj.def.h)*.75;c.font=`${fs}px serif`;
    c.fillText(obj.def.icon,sx+TILE*obj.def.w/2,sy+TILE*obj.def.h/2);
    if(obj.hp<obj.maxHp){const bw=TILE*obj.def.w;c.fillStyle='#330000';c.fillRect(sx,sy-8,bw,5);c.fillStyle='#22aa22';c.fillRect(sx,sy-8,bw*(obj.hp/obj.maxHp),5);}
  }
  // Drops
  c.font=`${TILE*.5}px serif`;
  for(const d of G.drops){
    const sx=d.x-cam.x+W/2,sy=d.y-cam.y+H/2;
    const bob=Math.sin(G.tick*.12)*3;
    c.fillText(ITEMS_DB[d.id]?.icon||'ğŸ“¦',sx,sy+bob);
  }
  // PartÃ­culas
  for(const pt of G.particles){
    const sx=pt.x-cam.x+W/2,sy=pt.y-cam.y+H/2;
    c.globalAlpha=pt.life/pt.maxLife;c.fillStyle=pt.color;
    c.beginPath();c.arc(sx,sy,pt.size,0,Math.PI*2);c.fill();
  }
  c.globalAlpha=1;
  // Outros jogadores
  for(const [id,op] of G.otherPlayers){
    const sx=op.x-cam.x+W/2,sy=op.y-cam.y+H/2;
    if(sx<-80||sx>W+80||sy<-80||sy>H+80)continue;
    const cls=(G.classes[op.class_id]||{icon:'ğŸ§‘',color:'#6a9aff'});
    drawPlayer(c,sx,sy,op.name,cls.color,op.hp/op.maxHp,false,cls.icon);
  }
  // Mobs
  for(const mob of G.mobs){
    const sx=mob.x-cam.x+W/2,sy=mob.y-cam.y+H/2;
    if(sx<-80||sx>W+80||sy<-80||sy>H+80)continue;
    c.font='24px serif';c.textAlign='center';c.textBaseline='middle';
    const bob=Math.sin(G.tick*.08+mob.id*.5)*3;c.fillText(mob.icon,sx,sy+bob);
    const bw=32;c.fillStyle='#330000';c.fillRect(sx-bw/2,sy-22,bw,4);c.fillStyle='#cc2222';c.fillRect(sx-bw/2,sy-22,bw*(mob.hp/mob.maxHp),4);
    c.font='bold 9px Cinzel,serif';c.fillStyle='#ff8888';c.textBaseline='bottom';c.fillText(mob.name,sx,sy-22);
  }
  // Jogador
  const cls=G.classes[G.player.class_id]||{icon:'ğŸ§‘',color:'#f0c040'};
  drawPlayer(c,W/2,H/2,G.player.name,cls.color,G.player.hp/G.player.maxHp,true,cls.icon);
  // Cursor
  if(!G.invOpen&&!G.craftOpen){
    c.strokeStyle='rgba(240,192,0,.45)';c.lineWidth=1.5;c.strokeRect(G.mouse.x-18,G.mouse.y-18,36,36);c.lineWidth=1;
  }
  // Preview construÃ§Ã£o
  if(G.selectedBuild&&!G.invOpen&&!G.craftOpen){
    const wx=Math.floor((G.mouse.x+cam.x-W/2)/TILE),wy=Math.floor((G.mouse.y+cam.y-H/2)/TILE);
    const sx=wx*TILE-cam.x+W/2,sy=wy*TILE-cam.y+H/2;
    c.globalAlpha=.5;c.fillStyle='#5a4020';c.fillRect(sx,sy,TILE,TILE);
    c.font=`${TILE*.6}px serif`;c.textAlign='center';c.textBaseline='middle';
    c.fillText(ITEMS_DB[G.selectedBuild]?.icon||'',sx+TILE/2,sy+TILE/2);c.globalAlpha=1;
  }
  // Overlay noite
  if(G.dayPhase==='night'){
    const grd=c.createRadialGradient(W/2,H/2,80,W/2,H/2,Math.max(W,H)*.7);
    grd.addColorStop(0,'rgba(0,0,0,0)');grd.addColorStop(1,'rgba(0,0,20,.65)');
    c.fillStyle=grd;c.fillRect(0,0,W,H);
  }
  // Minimap
  renderMinimap();
}

function drawPlayer(c,sx,sy,name,color,hpPct,isMe,icon='ğŸ§‘'){
  c.fillStyle='rgba(0,0,0,.25)';c.beginPath();c.ellipse(sx,sy+19,15,5,0,0,Math.PI*2);c.fill();
  c.fillStyle=isMe?'#f0c040':color;
  c.beginPath();c.arc(sx,sy,16,0,Math.PI*2);c.fill();
  c.strokeStyle=isMe?'#ffe060':'rgba(255,255,255,.35)';c.lineWidth=isMe?2.5:1.5;c.stroke();c.lineWidth=1;
  c.font='15px serif';c.textAlign='center';c.textBaseline='middle';c.fillText(icon,sx,sy);
  c.font='bold 10px Cinzel,serif';c.fillStyle='#fff';c.textBaseline='bottom';c.fillText(name,sx,sy-20);
  const bw=34;c.fillStyle='#330000';c.fillRect(sx-bw/2,sy-28,bw,4);
  c.fillStyle=hpPct>.5?'#22cc22':hpPct>.25?'#ccaa00':'#cc2222';c.fillRect(sx-bw/2,sy-28,bw*Math.max(0,hpPct),4);
}

function renderMinimap(){
  const mm=G.mmctx,mw=140,mh=140;
  mm.clearRect(0,0,mw,mh);
  mm.fillStyle='#0a0608';mm.fillRect(0,0,mw,mh);
  const scale=.6,ox=G.player.x/TILE-mw/(2*scale),oy=G.player.y/TILE-mh/(2*scale);
  for(let x=0;x<mw;x+=2)for(let y=0;y<mh;y+=2){
    mm.fillStyle=getTileColor(Math.floor(ox+x/scale),Math.floor(oy+y/scale));mm.fillRect(x,y,2,2);
  }
  for(const[,op]of G.otherPlayers){const bx=(op.x/TILE-ox)*scale,by=(op.y/TILE-oy)*scale;if(bx<0||bx>mw||by<0||by>mh)continue;mm.fillStyle='#44aaff';mm.fillRect(bx-2,by-2,5,5);}
  for(const mob of G.mobs){const bx=(mob.x/TILE-ox)*scale,by=(mob.y/TILE-oy)*scale;if(bx<0||bx>mw||by<0||by>mh)continue;mm.fillStyle='#ff4400';mm.fillRect(bx-1,by-1,3,3);}
  mm.fillStyle='#ff3300';mm.beginPath();mm.arc(mw/2,mh/2,4,0,Math.PI*2);mm.fill();
  mm.fillStyle='#fff';mm.beginPath();mm.arc(mw/2,mh/2,2,0,Math.PI*2);mm.fill();
  mm.strokeStyle='#3a2010';mm.lineWidth=2;mm.strokeRect(0,0,mw,mh);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gameLoop(){update();render();requestAnimationFrame(gameLoop);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enterGame(){
  const name=(document.getElementById('player-name-input').value.trim()||'Guerreiro').substring(0,18);
  if(!G.connected){showNotif('Aguarde a conexÃ£o...','notif-dmg');return;}
  document.getElementById('login-screen').style.display='none';
  document.getElementById('hud').style.display='block';
  G.canvas=document.getElementById('gameCanvas');
  G.ctx=G.canvas.getContext('2d');
  G.mmc=document.getElementById('minimap');
  G.mmctx=G.mmc.getContext('2d');
  G.W=G.canvas.width=window.innerWidth;
  G.H=G.canvas.height=window.innerHeight;
  window.addEventListener('resize',()=>{G.W=G.canvas.width=window.innerWidth;G.H=G.canvas.height=window.innerHeight;});
  // Input
  window.addEventListener('keydown',e=>{
    G.keys[e.key]=true;
    if(e.key>='1'&&e.key<='9'){G.hotbarIdx=parseInt(e.key)-1;updateHotbarUI();}
    if(e.key==='0'){G.hotbarIdx=9;updateHotbarUI();}
    if(e.key==='e'||e.key==='E'){if(!G.craftOpen&&!G.buildOpen)toggleInventory();}
    if(e.key==='c'||e.key==='C'){if(!G.invOpen&&!G.buildOpen)toggleCraft();}
    if(e.key==='b'||e.key==='B'){if(!G.invOpen&&!G.craftOpen)toggleBuild();}
    if(e.key==='Escape'){if(G.invOpen)toggleInventory();if(G.craftOpen)toggleCraft();if(G.buildOpen)toggleBuild();}
    if(e.key==='t'||e.key==='T'){if(!G.invOpen&&!G.craftOpen){document.getElementById('chat-input').focus();e.preventDefault();}}
  });
  window.addEventListener('keyup',e=>{G.keys[e.key]=false;});
  G.canvas.addEventListener('mousemove',e=>{G.mouse.x=e.clientX;G.mouse.y=e.clientY;});
  G.canvas.addEventListener('mousedown',e=>{
    G.mouse.down=true;
    if(G.invOpen||G.craftOpen)return;
    if(G.selectedBuild){
      const wx=Math.floor((e.clientX+G.camera.x-G.W/2)/TILE),wy=Math.floor((e.clientY+G.camera.y-G.H/2)/TILE);
      placeBlock(wx,wy);
    } else {tryInteract();}
  });
  G.canvas.addEventListener('mouseup',()=>{G.mouse.down=false;});
  G.canvas.addEventListener('wheel',e=>{G.hotbarIdx=(G.hotbarIdx+(e.deltaY>0?1:-1)+10)%10;updateHotbarUI();});
  document.getElementById('chat-input').addEventListener('keydown',e=>{
    if(e.key==='Enter'){sendChat();document.getElementById('chat-input').blur();e.preventDefault();}
    if(e.key==='Escape')document.getElementById('chat-input').blur();
    e.stopPropagation();
  });
  // Envia JOIN
  wsSend({type:'join',name});
  spawnMobs(8);
  updateHotbarUI();
  gameLoop();
}

// PartÃ­culas tela login
(()=>{const c=document.getElementById('particles');for(let i=0;i<28;i++){const s=document.createElement('span');s.style.left=Math.random()*100+'%';s.style.animationDelay=Math.random()*6+'s';s.style.animationDuration=(4+Math.random()*5)+'s';c.appendChild(s);}})();
document.getElementById('player-name-input').addEventListener('keydown',e=>{if(e.key==='Enter')enterGame();});

// Conecta WS ao carregar
connectWS();
</script>
</body>
</html>
